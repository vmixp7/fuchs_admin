<% layout("layout") %>

    <!-- Page Content -->
    <div class="flex-grow-1">
        <!-- Topbar -->
        <nav class="navbar navbar-light bg-white border-bottom px-4">
            <span class="navbar-text">ğŸ‘‹ æ­¡è¿ï¼Œ<%= username %></span>
        </nav>

        <!-- Main Content -->
        <div class="container-fluid py-4">
            <h4 class="mb-4"><i class="bi bi-building me-2"></i> å…¬å¸ç°¡ä»‹ç®¡ç†</h4>

            <!-- ç·¨è¼¯è¡¨å–® -->
            <div class="card shadow-sm">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-pencil-square me-2"></i> ç·¨è¼¯å…¬å¸ç°¡ä»‹</h5>
                </div>
                <div class="card-body">
                    <form id="aboutForm">
                        <input type="hidden" id="aboutId" name="id">
                        <div class="mb-3">
                            <label for="content" class="form-label">å…¬å¸ç°¡ä»‹å…§å®¹ <span class="text-danger">*</span></label>
                            <textarea class="form-control" id="content" name="content" rows="10" required
                                placeholder="è«‹è¼¸å…¥å…¬å¸ç°¡ä»‹å…§å®¹..."></textarea>
                            <small class="text-muted">æ­¤æ¬„ä½ç‚ºå¿…å¡«é …</small>
                        </div>
                        <div class="mt-3">
                            <button type="submit" class="btn btn-light-blue">
                                <i class="bi bi-save me-1"></i> å„²å­˜
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="loadAbout()">
                                <i class="bi bi-arrow-clockwise me-1"></i> é‡æ–°è¼‰å…¥
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!-- Main Content -->
    </div>
    </div>

    <script>
        // é é¢è¼‰å…¥æ™‚ç²å–å…¬å¸ç°¡ä»‹
        $(document).ready(function () {
            loadAbout();
        });

        // è¼‰å…¥å…¬å¸ç°¡ä»‹
        function loadAbout() {
            $.get('/api/about', function (data) {
                if (data) {
                    $('#aboutId').val(data.id);
                    $('#content').val(data.content);
                }
            }).fail(function (xhr) {
                alert('è¼‰å…¥å…¬å¸ç°¡ä»‹å¤±æ•—ï¼š' + (xhr.responseJSON?.message || 'æœªçŸ¥éŒ¯èª¤'));
            });
        }

        // æ›´æ–°å…¬å¸ç°¡ä»‹
        $('#aboutForm').on('submit', function (e) {
            e.preventDefault();

            const id = $('#aboutId').val();
            const content = $('#content').val().trim();

            if (!content) {
                alert('å…¬å¸ç°¡ä»‹å…§å®¹ç‚ºå¿…å¡«é …ï¼');
                return;
            }

            $.ajax({
                url: '/api/about',
                type: 'PUT',
                contentType: 'application/json',
                data: JSON.stringify({ id: id, content: content }),
                success: function (response) {
                    alert('å„²å­˜æˆåŠŸï¼');
                    loadAbout();
                },
                error: function (xhr) {
                    alert('å„²å­˜å¤±æ•—ï¼š' + (xhr.responseJSON?.message || 'æœªçŸ¥éŒ¯èª¤'));
                }
            });
        });
    </script>